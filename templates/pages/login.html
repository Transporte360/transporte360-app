{% extends "layouts/base.html" %}
{% set title = "Iniciar Sesi√≥n - Transporte360" %}

{% block content %}
<body class="login-v2">
  <!-- Background grid -->
  <div class="login-bg-grid" aria-hidden="true">
    <svg class="login-bg-svg" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="1"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#grid)"/>
    </svg>
  </div>

  <main class="login-wrap-v2">
    <div class="login-container-v2">

      <!-- Branding -->
      <header class="login-brand-v2">
        <div class="login-logo-v2" aria-hidden="true">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" width="64" height="64">
            <rect width="64" height="64" rx="12" fill="#1E3A5F"/>
            <path d="M16 32L32 20L48 32M20 36V44C20 45.1046 20.8954 46 22 46H42C43.1046 46 44 45.1046 44 44V36"
                  stroke="#E67E22" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="32" cy="32" r="4" fill="#E67E22"/>
          </svg>
        </div>
        <h1 class="login-title-v2">Transporte360</h1>
        <p class="login-subtitle-v2">Sistema de Gesti√≥n de Flotas</p>
      </header>

      <!-- Card -->
      <section class="login-card-v2">
        <div class="login-card-head-v2">
          <h2>Iniciar Sesi√≥n</h2>
          <p>Ingrese sus credenciales para acceder al sistema</p>
        </div>

        {% if error %}
        <div class="login-error-v2" role="alert">
          <div class="login-error-ic" aria-hidden="true">‚ö†Ô∏è</div>
          <div class="login-error-text">{{ error }}</div>
        </div>
        {% endif %}

        <form id="loginForm" class="login-form-v2" method="post" action="/login" novalidate>
          <!-- Username -->
          <div class="login-field-v2">
            <label for="username" class="login-label-v2">
              <span class="ic" aria-hidden="true">üë§</span> Nombre de Usuario
            </label>
            <div class="login-input-wrap-v2">
              <span class="login-input-ic-v2" aria-hidden="true">
                <!-- user icon -->
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M20 21a8 8 0 10-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M12 13a4 4 0 100-8 4 4 0 000 8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </span>
              <input
                type="text"
                id="username"
                name="username"
                class="login-input-v2"
                placeholder="Ingrese su nombre de usuario"
                autocomplete="username"
                required
              />
            </div>
          </div>

          <!-- PIN -->
          <div class="login-field-v2">
            <label for="pin" class="login-label-v2">
              <span class="ic" aria-hidden="true">üîí</span> PIN de Acceso
            </label>
            <div class="login-input-wrap-v2">
              <span class="login-input-ic-v2" aria-hidden="true">
                <!-- lock icon -->
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M7 11V8a5 5 0 0110 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 11h10a2 2 0 012 2v6a2 2 0 01-2 2H7a2 2 0 01-2-2v-6a2 2 0 012-2z" stroke="currentColor" stroke-width="2"/>
                </svg>
              </span>

              <input
                type="password"
                id="pin"
                name="pin"
                class="login-input-v2 login-pin-v2"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                inputmode="numeric"
                maxlength="4"
                pattern="[0-9]{4}"
                autocomplete="current-password"
                required
              />

              <button type="button" id="togglePin" class="login-eye-v2" aria-label="Mostrar/Ocultar PIN">
                <svg id="eyeOpen" viewBox="0 0 24 24" fill="none">
                  <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="2"/>
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg id="eyeOff" class="hidden" viewBox="0 0 24 24" fill="none">
                  <path d="M3 3l18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M2 12s3.5-7 10-7c2 0 3.7.6 5.2 1.5M22 12s-3.5 7-10 7c-2 0-3.7-.6-5.2-1.5"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>

            <p class="login-hint-v2">Ingrese su PIN de 4 d√≠gitos</p>
          </div>

          <!-- Remember me (opcional, solo UI) -->
          <div class="login-remember-v2">
            <input type="checkbox" id="rememberMe" name="rememberMe" />
            <label for="rememberMe">Recordar mis credenciales</label>
          </div>

          <!-- Button -->
          <button type="submit" id="loginButton" class="login-btn-v2">
            <span id="loginButtonText">Iniciar Sesi√≥n</span>
            <span id="loadingSpinner" class="login-spinner-v2 hidden" aria-hidden="true"></span>
          </button>
        </form>

        <!-- Help -->
        <div class="login-help-v2">
          <div class="login-help-ic" aria-hidden="true">‚ÑπÔ∏è</div>
          <div>
            <p>
              <strong>Requisitos del Sistema:</strong><br/>
              Navegador actualizado con JavaScript habilitado
            </p>
            <p style="margin-top:10px">
              <strong>¬øProblemas para acceder?</strong><br/>
              Contacte al administrador del sistema para asistencia
            </p>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer class="login-footer-v2">
        ¬© 2026 Transporte360. Todos los derechos reservados.
      </footer>

    </div>
  </main>

  <script>
    // PIN: solo n√∫meros
    const pin = document.getElementById("pin");
    pin?.addEventListener("input", (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g, "");
    });

    // Toggle PIN
    const toggle = document.getElementById("togglePin");
    const eyeOpen = document.getElementById("eyeOpen");
    const eyeOff = document.getElementById("eyeOff");
    toggle?.addEventListener("click", () => {
      const isHidden = pin.type === "password";
      pin.type = isHidden ? "text" : "password";
      eyeOpen.classList.toggle("hidden", isHidden);
      eyeOff.classList.toggle("hidden", !isHidden);
    });

    // Loading state (mejora UX)
    const form = document.getElementById("loginForm");
    const btn = document.getElementById("loginButton");
    const btnText = document.getElementById("loginButtonText");
    const spinner = document.getElementById("loadingSpinner");
    form?.addEventListener("submit", () => {
      btn.disabled = true;
      btn.classList.add("is-loading");
      btnText.textContent = "Verificando...";
      spinner.classList.remove("hidden");
    });
  </script>
</body>
{% endblock %}
